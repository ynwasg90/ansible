- name: Vcenter user
  debug:
    msg: "Vcenter user is {{ user }}"

- name: Login into vCenter and get cookies
  uri:
    url: https://{{ vcenter_server }}/rest/com/vmware/cis/session
    force_basic_auth: yes
    validate_certs: no
    method: POST
    user: "{{ user }}"
    password: "{{ password }}"
  register: login

- name: Get all hosts from vCenter using cookies from last task
  uri:
    url: https://{{ vcenter_server }}/rest/vcenter/host
    force_basic_auth: yes
    validate_certs: no
    headers:
      Cookie: "{{ login.set_cookie }}"
  register: vchosts

- name: show vchosts
  debug:
    msg: "vchosts are {{ vchosts }}"